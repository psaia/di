{"version":3,"file":"","sourceRoot":"","sources":["canvas.js","di.js","dom.js","grid.js","pubsub.js","rect.js","shape.js","util.js"],"sourcesContent":["\"use strict\";\nexports.__esModule = true;\nvar dom = require(\"./dom\");\nvar pubsub_1 = require(\"./pubsub\");\nvar Canvas = /** @class */ (function () {\n    function Canvas(element) {\n        this.width = 0;\n        this.height = 0;\n        this.pixelScale = 1;\n        this.time = { prev: 0, diff: 0 };\n        this.animId = -1;\n        this.layers = [];\n        this.evt = new pubsub_1[\"default\"]();\n        this.container = element;\n        this.canvas = dom.canvas();\n        this.ctx = this.canvas.getContext(\"2d\");\n        this.pixelScale = window.devicePixelRatio;\n    }\n    Canvas.prototype.configure = function () {\n        var _this = this;\n        this.container.appendChild(this.canvas);\n        this.listen(this.canvas, \"mousemove\", function (e) {\n            _this.evt.publish(\"mousemove\", e);\n        });\n        this.listen(this.canvas, \"mousedown\", function (e) {\n            _this.evt.publish(\"mousedown\", e);\n        });\n        this.listen(this.canvas, \"mouseup\", function (e) {\n            _this.evt.publish(\"mouseup\", e);\n        });\n        this.listen(window, \"resize\", function () {\n            _this.resize();\n            _this.evt.publish(\"resize\", null);\n        });\n        this.resize();\n        this.play();\n        return this;\n    };\n    Canvas.prototype.listen = function (o, evt, fn) {\n        this.evt.publish(evt, null);\n        o.addEventListener(evt, fn, false);\n    };\n    Canvas.prototype.setColor = function (c) { };\n    Canvas.prototype.play = function (time) {\n        if (time === void 0) { time = 0; }\n        this.animId = requestAnimationFrame(this.play.bind(this));\n        this.time.diff = time - this.time.prev;\n        this.time.prev = time;\n        this.ctx.fillStyle = \"#222222\";\n        try {\n            this.renderLayers();\n        }\n        catch (err) {\n            throw err;\n        }\n    };\n    Canvas.prototype.renderLayers = function () {\n        this.clear();\n        for (var i = 0, l = this.layers.length; i < l; i++) {\n            this.layers[i].render(this.ctx, this);\n        }\n    };\n    Canvas.prototype.addLayer = function (layer) {\n        this.layers.push(layer);\n    };\n    Canvas.prototype.resize = function () {\n        var _a = dom.getDimensions(this.container), width = _a.width, height = _a.height;\n        var scaledHeight = height * this.pixelScale;\n        this.width = width;\n        this.height = height;\n        dom.attr(this.canvas, \"width\", width * this.pixelScale);\n        dom.attr(this.canvas, \"height\", height * this.pixelScale);\n        this.canvas.width = width * this.pixelScale;\n        this.canvas.height = height * this.pixelScale;\n        this.canvas.style.width = Math.floor(width) + \"px\";\n        this.canvas.style.height = Math.floor(height) + \"px\";\n        if (this.pixelScale > 1) {\n            this.ctx.scale(this.pixelScale, this.pixelScale);\n            this.ctx.translate(0.5, 0.5);\n        }\n        this.renderLayers();\n    };\n    Canvas.prototype.clear = function () {\n        this.ctx.fillStyle = \"#1b212b\";\n        this.ctx.fillRect(-1, -1, this.width + 1, this.height + 1);\n    };\n    return Canvas;\n}());\nexports[\"default\"] = Canvas;\n//# sourceMappingURL=canvas.js.map","\"use strict\";\nexports.__esModule = true;\nvar dom = require(\"./dom\");\nvar util = require(\"./util\");\nvar canvas_1 = require(\"./canvas\");\nvar rect_1 = require(\"./rect\");\nvar grid_1 = require(\"./grid\");\nvar ActionType;\n(function (ActionType) {\n    ActionType[ActionType[\"MOVING\"] = 1] = \"MOVING\";\n    ActionType[ActionType[\"CREATING\"] = 2] = \"CREATING\";\n})(ActionType || (ActionType = {}));\nvar Di = /** @class */ (function () {\n    function Di(parentEl) {\n        var canvas = new canvas_1[\"default\"](dom.select(parentEl)).configure();\n        var grid = new grid_1[\"default\"]();\n        var rects = [];\n        var lastRect = function () { return rects[rects.length - 1]; };\n        var rectAction;\n        var _activeRect;\n        var clickedPt = util.pt();\n        var mouseDown = false;\n        canvas.addLayer(grid);\n        grid.setSize(canvas.width, canvas.height);\n        var activeRect = function () {\n            for (var i = 0, l = rects.length; i < l; i++) {\n                if (rect_1[\"default\"].withinBound(grid.cursorPt, rects[i].pts)) {\n                    return rects[i];\n                }\n            }\n        };\n        var tmpPts;\n        canvas.evt.subscribe(\"mousemove\", function (e) {\n            grid.setCursor(util.pt(e.x, e.y));\n            // If clicking into a square, move it. If not, create a new.\n            if (mouseDown) {\n                if (rectAction === ActionType.CREATING) {\n                    _activeRect.pts = [clickedPt, grid.closestPt];\n                }\n                else if (rectAction === ActionType.MOVING) {\n                    _activeRect.pts = util.subtract(util.subtract(grid.closestPt, [clickedPt])[0], tmpPts);\n                }\n            }\n        });\n        canvas.evt.subscribe(\"mousedown\", function (e) {\n            mouseDown = true;\n            clickedPt = grid.closestPt;\n            _activeRect = activeRect();\n            if (!_activeRect) {\n                rectAction = ActionType.CREATING;\n                // Add a new grid on the stack.\n                _activeRect = new rect_1[\"default\"](grid.grid);\n                canvas.addLayer(_activeRect);\n                rects.push(_activeRect);\n            }\n            else {\n                tmpPts = util.clone(_activeRect.pts);\n                rectAction = ActionType.MOVING;\n            }\n        });\n        canvas.evt.subscribe(\"mouseup\", function (e) {\n            mouseDown = false;\n        });\n        canvas.evt.subscribe(\"resize\", function (e) {\n            grid.setSize(canvas.width, canvas.height);\n        });\n    }\n    return Di;\n}());\nexports[\"default\"] = Di;\n// Ghetto exposure.\nvar w = window;\nw.Di = Di;\n//# sourceMappingURL=di.js.map","\"use strict\";\nexports.__esModule = true;\nvar NS = \"http://www.w3.org/2000/svg\";\nfunction getDimensions(element) {\n    var dim = element.getBoundingClientRect();\n    return {\n        height: dim.height,\n        width: dim.width\n    };\n}\nexports.getDimensions = getDimensions;\nfunction select(selector) {\n    return document.querySelector(selector);\n}\nexports.select = select;\nfunction attr(element, key, value) {\n    if (typeof value === \"undefined\") {\n        return element.getAttribute(key);\n    }\n    element.setAttribute(key, String(value));\n    return String(value);\n}\nexports.attr = attr;\nfunction circle(r, x, y) {\n    var el = document.createElementNS(NS, \"circle\");\n    attr(el, \"r\", String(r));\n    attr(el, \"cx\", String(x));\n    attr(el, \"cy\", String(y));\n    attr(el, \"fill\", \"#333\");\n    return el;\n}\nexports.circle = circle;\nfunction canvas() {\n    return document.createElement(\"canvas\");\n}\nexports.canvas = canvas;\n//# sourceMappingURL=dom.js.map","\"use strict\";\nexports.__esModule = true;\nvar Grid = /** @class */ (function () {\n    function Grid() {\n        this.density = 10;\n        this.size = {\n            width: 100,\n            height: 100\n        };\n        this.cursorPt = new Float32Array([0, 0]);\n    }\n    Grid.prototype.setSize = function (width, height) {\n        this.size = { width: width, height: height };\n    };\n    Grid.prototype.setCursor = function (p) {\n        this.cursorPt = p;\n    };\n    Grid.prototype.render = function (ctx) {\n        var grid = [];\n        var w = this.size.width;\n        var h = this.size.height;\n        var buffer = 5;\n        for (var i = 0; i < w; i++) {\n            if (i < buffer || i > w - buffer)\n                continue;\n            if (i % this.density === 0) {\n                for (var k = 0; k < h; k++) {\n                    if (k < buffer || k > h - buffer)\n                        continue;\n                    if (k % this.density === 0) {\n                        ctx.beginPath();\n                        if (Math.abs(this.cursorPt[1] - k) < buffer &&\n                            Math.abs(this.cursorPt[0] - i) < buffer) {\n                            ctx.fillStyle = \"#999999\";\n                            this.closestPt = new Float32Array([i, k]);\n                        }\n                        else {\n                            ctx.fillStyle = \"#333\";\n                        }\n                        ctx.arc(i, k, 1, 0, Math.PI * 2, true);\n                        ctx.fill();\n                        grid.push(new Float32Array([i, k]));\n                    }\n                }\n            }\n        }\n        this.grid = grid;\n        return grid;\n    };\n    return Grid;\n}());\nexports[\"default\"] = Grid;\n//# sourceMappingURL=grid.js.map","\"use strict\";\nexports.__esModule = true;\nvar Pubsub = /** @class */ (function () {\n    function Pubsub() {\n        this.events = [];\n    }\n    Pubsub.prototype.publish = function (name, payload) {\n        var evts = this.events;\n        for (var i = 0, l = evts.length; i < l; i++) {\n            if (name === evts[i].name) {\n                evts[i].fn(payload);\n            }\n        }\n    };\n    Pubsub.prototype.subscribe = function (name, fn, group) {\n        if (group === void 0) { group = \"global\"; }\n        this.events.push({ name: name, fn: fn, group: group });\n    };\n    return Pubsub;\n}());\nexports[\"default\"] = Pubsub;\n//# sourceMappingURL=pubsub.js.map","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nexports.__esModule = true;\nvar shape_1 = require(\"./shape\");\nvar util = require(\"./util\");\nvar Rect = /** @class */ (function (_super) {\n    __extends(Rect, _super);\n    function Rect() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Rect.prototype.render = function (ctx) {\n        if (!this.animating || this.pts.length < 2) {\n            return;\n        }\n        ctx.beginPath();\n        ctx.moveTo(this.pts[0][0], this.pts[0][1]);\n        ctx.lineTo(this.pts[0][0], this.pts[1][1]);\n        ctx.lineTo(this.pts[1][0], this.pts[1][1]);\n        ctx.lineTo(this.pts[1][0], this.pts[0][1]);\n        ctx.strokeStyle = this.color;\n        ctx.lineWidth = 2;\n        ctx.closePath();\n        if (this.filled) {\n            ctx.fill();\n        }\n        else {\n            ctx.stroke();\n        }\n    };\n    Rect.withinBound = function (pt, rect) {\n        if (!util.within(pt[0], rect[0][0], rect[1][0]) ||\n            !util.within(pt[1], rect[0][1], rect[1][1])) {\n            return false;\n        }\n        return true;\n    };\n    return Rect;\n}(shape_1[\"default\"]));\nexports[\"default\"] = Rect;\n//# sourceMappingURL=rect.js.map","\"use strict\";\nexports.__esModule = true;\nvar Shape = /** @class */ (function () {\n    function Shape(grid) {\n        this.pts = [];\n        this.grid = [];\n        this.animating = true;\n        this.filled = false;\n        this.color = \"#FFFFFF\";\n        this.grid = grid;\n    }\n    Shape.prototype.stop = function () {\n        this.animating = false;\n    };\n    Shape.prototype.play = function () {\n        this.animating = true;\n    };\n    return Shape;\n}());\nexports[\"default\"] = Shape;\n//# sourceMappingURL=shape.js.map","\"use strict\";\nexports.__esModule = true;\nfunction pt(x, y) {\n    if (x === undefined || y === undefined) {\n        return new Float32Array([0, 0]);\n    }\n    return new Float32Array([x, y]);\n}\nexports.pt = pt;\nfunction within(p, a, b) {\n    return p >= Math.min(a, b) && p <= Math.max(a, b);\n}\nexports.within = within;\nfunction add(a, b) {\n    return b.map(function (v) { return pt(v[0] + a[0], v[1] + a[1]); });\n}\nexports.add = add;\nfunction subtract(a, b) {\n    return b.map(function (v) { return pt(v[0] - a[0], v[1] - a[1]); });\n}\nexports.subtract = subtract;\nfunction clone(a) {\n    return a.map(function (v) { return pt(v[0], v[1]); });\n}\nexports.clone = clone;\nfunction multiply(a, b) {\n    return b.map(function (v) { return pt(v[0] * a[0], v[1] * a[1]); });\n}\nexports.multiply = multiply;\nfunction dot() {\n    var pts = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        pts[_i] = arguments[_i];\n    }\n    var init = new Float32Array([0, 0]);\n    return pts.reduce(function (acc, p) { return multiply(acc, p); }, init);\n}\nexports.dot = dot;\n//# sourceMappingURL=util.js.map"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACzFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACzEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACpCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACpDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACnDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;"}